"use client";import{useFocusRing as Ie}from"@react-aria/focus";import{useHover as Pe}from"@react-aria/interactions";import{useVirtualizer as He}from"@tanstack/react-virtual";import D,{Fragment as Ae,createContext as ce,createRef as Ue,useCallback as fe,useContext as Te,useMemo as j,useReducer as Ge,useRef as te,useState as Re}from"react";import{flushSync as oe}from"react-dom";import{useActivePress as ze}from'../../hooks/use-active-press.js';import{useByComparator as Ke}from'../../hooks/use-by-comparator.js';import{useControllable as je}from'../../hooks/use-controllable.js';import{useDefaultValue as We}from'../../hooks/use-default-value.js';import{useDisposables as $e}from'../../hooks/use-disposables.js';import{useElementSize as _e}from'../../hooks/use-element-size.js';import{useEvent as c}from'../../hooks/use-event.js';import{useId as de}from'../../hooks/use-id.js';import{useInertOthers as Xe}from'../../hooks/use-inert-others.js';import{useIsoMorphicEffect as q}from'../../hooks/use-iso-morphic-effect.js';import{useLatestValue as Je}from'../../hooks/use-latest-value.js';import{useOnDisappear as qe}from'../../hooks/use-on-disappear.js';import{useOutsideClick as Ye}from'../../hooks/use-outside-click.js';import{useOwnerDocument as xe}from'../../hooks/use-owner.js';import{useRefocusableInput as he}from'../../hooks/use-refocusable-input.js';import{useResolveButtonType as Qe}from'../../hooks/use-resolve-button-type.js';import{useScrollLock as Ze}from'../../hooks/use-scroll-lock.js';import{useSyncRefs as be}from'../../hooks/use-sync-refs.js';import{useTrackedPointer as et}from'../../hooks/use-tracked-pointer.js';import{transitionDataAttributes as tt,useTransition as ot}from'../../hooks/use-transition.js';import{useTreeWalker as nt}from'../../hooks/use-tree-walker.js';import{useWatch as Me}from'../../hooks/use-watch.js';import{useDisabled as rt}from'../../internal/disabled.js';import{FloatingProvider as it,useFloatingPanel as lt,useFloatingPanelProps as at,useFloatingReference as ut,useResolvedAnchor as pt}from'../../internal/floating.js';import{FormFields as st}from'../../internal/form-fields.js';import{Frozen as dt,useFrozenData as De}from'../../internal/frozen.js';import{useProvidedId as bt}from'../../internal/id.js';import{OpenClosedProvider as mt,State as me,useOpenClosed as ct}from'../../internal/open-closed.js';import{history as Fe}from'../../utils/active-element-history.js';import{isDisabledReactIssue7711 as ft}from'../../utils/bugs.js';import{Focus as P,calculateActiveIndex as Ve}from'../../utils/calculate-active-index.js';import{disposables as Le}from'../../utils/disposables.js';import{sortByDomNode as Tt}from'../../utils/focus-management.js';import{match as ne}from'../../utils/match.js';import{isMobile as xt}from'../../utils/platform.js';import{RenderFeatures as we,forwardRefWithAs as ie,mergeProps as ge,useRender as le}from'../../utils/render.js';import{useDescribedBy as gt}from'../description/description.js';import{Keys as V}from'../keyboard.js';import{Label as vt,useLabelledBy as ve,useLabels as yt}from'../label/label.js';import{MouseButton as Be}from'../mouse.js';import{Portal as Ot}from'../portal/portal.js';var Ct=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Ct||{}),Et=(e=>(e[e.Single=0]="Single",e[e.Multi=1]="Multi",e))(Et||{}),St=(o=>(o[o.Pointer=0]="Pointer",o[o.Focus=1]="Focus",o[o.Other=2]="Other",o))(St||{}),It=(l=>(l[l.OpenCombobox=0]="OpenCombobox",l[l.CloseCombobox=1]="CloseCombobox",l[l.GoToOption=2]="GoToOption",l[l.SetTyping=3]="SetTyping",l[l.RegisterOption=4]="RegisterOption",l[l.UnregisterOption=5]="UnregisterOption",l[l.SetActivationTrigger=6]="SetActivationTrigger",l[l.UpdateVirtualConfiguration=7]="UpdateVirtualConfiguration",l[l.SetInputElement=8]="SetInputElement",l[l.SetButtonElement=9]="SetButtonElement",l[l.SetOptionsElement=10]="SetOptionsElement",l))(It||{});function ye(t,n=e=>e){let e=t.activeOptionIndex!==null?t.options[t.activeOptionIndex]:null,o=n(t.options.slice()),f=o.length>0&&o[0].dataRef.current.order!==null?o.sort((m,d)=>m.dataRef.current.order-d.dataRef.current.order):Tt(o,m=>m.dataRef.current.domRef.current),b=e?f.indexOf(e):null;return b===-1&&(b=null),{options:f,activeOptionIndex:b}}let Pt={[1](t){var n;return(n=t.dataRef.current)!=null&&n.disabled||t.comboboxState===1?t:{...t,activeOptionIndex:null,comboboxState:1,isTyping:!1,activationTrigger:2,__demoMode:!1}},[0](t){var n,e;if((n=t.dataRef.current)!=null&&n.disabled||t.comboboxState===0)return t;if((e=t.dataRef.current)!=null&&e.value){let o=t.dataRef.current.calculateIndex(t.dataRef.current.value);if(o!==-1)return{...t,activeOptionIndex:o,comboboxState:0,__demoMode:!1}}return{...t,comboboxState:0,__demoMode:!1}},[3](t,n){return t.isTyping===n.isTyping?t:{...t,isTyping:n.isTyping}},[2](t,n){var b,m,d,x;if((b=t.dataRef.current)!=null&&b.disabled||t.optionsElement&&!((m=t.dataRef.current)!=null&&m.optionsPropsRef.current.static)&&t.comboboxState===1)return t;if(t.virtual){let{options:i,disabled:r}=t.virtual,l=n.focus===P.Specific?n.idx:Ve(n,{resolveItems:()=>i,resolveActiveIndex:()=>{var R,s;return(s=(R=t.activeOptionIndex)!=null?R:i.findIndex(F=>!r(F)))!=null?s:null},resolveDisabled:r,resolveId(){throw new Error("Function not implemented.")}}),S=(d=n.trigger)!=null?d:2;return t.activeOptionIndex===l&&t.activationTrigger===S?t:{...t,activeOptionIndex:l,activationTrigger:S,isTyping:!1,__demoMode:!1}}let e=ye(t);if(e.activeOptionIndex===null){let i=e.options.findIndex(r=>!r.dataRef.current.disabled);i!==-1&&(e.activeOptionIndex=i)}let o=n.focus===P.Specific?n.idx:Ve(n,{resolveItems:()=>e.options,resolveActiveIndex:()=>e.activeOptionIndex,resolveId:i=>i.id,resolveDisabled:i=>i.dataRef.current.disabled}),f=(x=n.trigger)!=null?x:2;return t.activeOptionIndex===o&&t.activationTrigger===f?t:{...t,...e,isTyping:!1,activeOptionIndex:o,activationTrigger:f,__demoMode:!1}},[4]:(t,n)=>{var b,m,d;if((b=t.dataRef.current)!=null&&b.virtual)return{...t,options:[...t.options,n.payload]};let e=n.payload,o=ye(t,x=>(x.push(e),x));t.activeOptionIndex===null&&(m=t.dataRef.current)!=null&&m.isSelected(n.payload.dataRef.current.value)&&(o.activeOptionIndex=o.options.indexOf(e));let f={...t,...o,activationTrigger:2};return(d=t.dataRef.current)!=null&&d.__demoMode&&t.dataRef.current.value===void 0&&(f.activeOptionIndex=0),f},[5]:(t,n)=>{var o;if((o=t.dataRef.current)!=null&&o.virtual)return{...t,options:t.options.filter(f=>f.id!==n.id)};let e=ye(t,f=>{let b=f.findIndex(m=>m.id===n.id);return b!==-1&&f.splice(b,1),f});return{...t,...e,activationTrigger:2}},[6]:(t,n)=>t.activationTrigger===n.trigger?t:{...t,activationTrigger:n.trigger},[7]:(t,n)=>{var o,f;if(t.virtual===null)return{...t,virtual:{options:n.options,disabled:(o=n.disabled)!=null?o:()=>!1}};if(t.virtual.options===n.options&&t.virtual.disabled===n.disabled)return t;let e=t.activeOptionIndex;if(t.activeOptionIndex!==null){let b=n.options.indexOf(t.virtual.options[t.activeOptionIndex]);b!==-1?e=b:e=null}return{...t,activeOptionIndex:e,virtual:{options:n.options,disabled:(f=n.disabled)!=null?f:()=>!1}}},[8]:(t,n)=>t.inputElement===n.element?t:{...t,inputElement:n.element},[9]:(t,n)=>t.buttonElement===n.element?t:{...t,buttonElement:n.element},[10]:(t,n)=>t.optionsElement===n.element?t:{...t,optionsElement:n.element}},Oe=ce(null);Oe.displayName="ComboboxActionsContext";function ae(t){let n=Te(Oe);if(n===null){let e=new Error(`<${t} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(e,ae),e}return n}let Ne=ce(null);function At(t){let n=re("VirtualProvider"),{options:e}=n.virtual,[o,f]=j(()=>{let i=n.optionsElement;if(!i)return[0,0];let r=window.getComputedStyle(i);return[parseFloat(r.paddingBlockStart||r.paddingTop),parseFloat(r.paddingBlockEnd||r.paddingBottom)]},[n.optionsElement]),b=He({enabled:e.length!==0,scrollPaddingStart:o,scrollPaddingEnd:f,count:e.length,estimateSize(){return 40},getScrollElement(){return n.optionsElement},overscan:12}),[m,d]=Re(0);q(()=>{d(i=>i+1)},[e]);let x=b.getVirtualItems();return x.length===0?null:D.createElement(Ne.Provider,{value:b},D.createElement("div",{style:{position:"relative",width:"100%",height:`${b.getTotalSize()}px`},ref:i=>{i&&n.activationTrigger!==0&&n.activeOptionIndex!==null&&e.length>n.activeOptionIndex&&b.scrollToIndex(n.activeOptionIndex)}},x.map(i=>{var r;return D.createElement(Ae,{key:i.key},D.cloneElement((r=t.children)==null?void 0:r.call(t,{...t.slot,option:e[i.index]}),{key:`${m}-${i.key}`,"data-index":i.index,"aria-setsize":e.length,"aria-posinset":i.index+1,style:{position:"absolute",top:0,left:0,transform:`translateY(${i.start}px)`,overflowAnchor:"none"}}))})))}let ue=ce(null);ue.displayName="ComboboxDataContext";function re(t){let n=Te(ue);if(n===null){let e=new Error(`<${t} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(e,re),e}return n}function Rt(t,n){return ne(n.type,Pt,t,n)}let _t=Ae;function ht(t,n){var Ce,Ee;let e=rt(),{value:o,defaultValue:f,onChange:b,form:m,name:d,by:x,disabled:i=e||!1,onClose:r,__demoMode:l=!1,multiple:S=!1,immediate:R=!1,virtual:s=null,nullable:F,...w}=t,_=We(f),[I=S?[]:void 0,C]=je(o,b,_),[A,g]=Ge(Rt,{dataRef:Ue(),comboboxState:l?0:1,isTyping:!1,options:[],virtual:s?{options:s.options,disabled:(Ce=s.disabled)!=null?Ce:()=>!1}:null,activeOptionIndex:null,activationTrigger:2,inputElement:null,buttonElement:null,optionsElement:null,__demoMode:l}),h=te(!1),B=te({static:!1,hold:!1}),T=Ke(x),W=c(p=>s?x===null?s.options.indexOf(p):s.options.findIndex(y=>T(y,p)):A.options.findIndex(y=>T(y.dataRef.current.value,p))),Y=fe(p=>ne(u.mode,{[1]:()=>I.some(y=>T(y,p)),[0]:()=>T(I,p)}),[I]),$=c(p=>A.activeOptionIndex===W(p)),u=j(()=>({...A,immediate:R,optionsPropsRef:B,value:I,defaultValue:_,disabled:i,mode:S?1:0,virtual:s?A.virtual:null,get activeOptionIndex(){if(h.current&&A.activeOptionIndex===null&&(s?s.options.length>0:A.options.length>0)){if(s){let y=s.options.findIndex(G=>{var se,Se;return!((Se=(se=s.disabled)==null?void 0:se.call(s,G))!=null&&Se)});if(y!==-1)return y}let p=A.options.findIndex(y=>!y.dataRef.current.disabled);if(p!==-1)return p}return A.activeOptionIndex},calculateIndex:W,compare:T,isSelected:Y,isActive:$}),[I,_,i,S,l,A,s]);q(()=>{var p;s&&g({type:7,options:s.options,disabled:(p=s.disabled)!=null?p:null})},[s,s==null?void 0:s.options,s==null?void 0:s.disabled]),q(()=>{A.dataRef.current=u},[u]);let X=u.comboboxState===0;Ye(X,[u.buttonElement,u.inputElement,u.optionsElement],()=>E.closeCombobox());let z=j(()=>{var p,y,G;return{open:u.comboboxState===0,disabled:i,activeIndex:u.activeOptionIndex,activeOption:u.activeOptionIndex===null?null:u.virtual?u.virtual.options[(p=u.activeOptionIndex)!=null?p:0]:(G=(y=u.options[u.activeOptionIndex])==null?void 0:y.dataRef.current.value)!=null?G:null,value:I}},[u,i,I]),H=c(()=>{if(u.activeOptionIndex!==null){if(E.setIsTyping(!1),u.virtual)K(u.virtual.options[u.activeOptionIndex]);else{let{dataRef:p}=u.options[u.activeOptionIndex];K(p.current.value)}E.goToOption(P.Specific,u.activeOptionIndex)}}),v=c(()=>{g({type:0}),h.current=!0}),U=c(()=>{g({type:1}),h.current=!1,r==null||r()}),pe=c(p=>{g({type:3,isTyping:p})}),ee=c((p,y,G)=>(h.current=!1,p===P.Specific?g({type:2,focus:P.Specific,idx:y,trigger:G}):g({type:2,focus:p,trigger:G}))),Q=c((p,y)=>(g({type:4,payload:{id:p,dataRef:y}}),()=>{u.isActive(y.current.value)&&(h.current=!0),g({type:5,id:p})})),K=c(p=>ne(u.mode,{[0](){return C==null?void 0:C(p)},[1](){let y=u.value.slice(),G=y.findIndex(se=>T(se,p));return G===-1?y.push(p):y.splice(G,1),C==null?void 0:C(y)}})),Z=c(p=>{g({type:6,trigger:p})}),M=c(p=>{g({type:8,element:p})}),a=c(p=>{g({type:9,element:p})}),N=c(p=>{g({type:10,element:p})}),E=j(()=>({onChange:K,registerOption:Q,goToOption:ee,setIsTyping:pe,closeCombobox:U,openCombobox:v,setActivationTrigger:Z,selectActiveOption:H,setInputElement:M,setButtonElement:a,setOptionsElement:N}),[]),[k,O]=yt(),L=n===null?{}:{ref:n},J=fe(()=>{if(_!==void 0)return C==null?void 0:C(_)},[C,_]),ke=le();return D.createElement(O,{value:k,props:{htmlFor:(Ee=u.inputElement)==null?void 0:Ee.id},slot:{open:u.comboboxState===0,disabled:i}},D.createElement(it,null,D.createElement(Oe.Provider,{value:E},D.createElement(ue.Provider,{value:u},D.createElement(mt,{value:ne(u.comboboxState,{[0]:me.Open,[1]:me.Closed})},d!=null&&D.createElement(st,{disabled:i,data:I!=null?{[d]:I}:{},form:m,onReset:J}),ke({ourProps:L,theirProps:w,slot:z,defaultTag:_t,name:"Combobox"}))))))}let Mt="input";function Dt(t,n){var ee,Q,K,Z,M;let e=re("Combobox.Input"),o=ae("Combobox.Input"),f=de(),b=bt(),{id:m=b||`headlessui-combobox-input-${f}`,onChange:d,displayValue:x,disabled:i=e.disabled||!1,autoFocus:r=!1,type:l="text",...S}=t,R=te(null),s=be(R,n,ut(),o.setInputElement),F=xe(e.inputElement),w=$e(),_=c(()=>{o.onChange(null),e.optionsElement&&(e.optionsElement.scrollTop=0),o.goToOption(P.Nothing)}),I=j(()=>{var a;return typeof x=="function"&&e.value!==void 0?(a=x(e.value))!=null?a:"":typeof e.value=="string"?e.value:""},[e.value,x]);Me(([a,N],[E,k])=>{if(e.isTyping)return;let O=R.current;O&&(O.autocomplete="off",(k===0&&N===1||a!==E)&&(O.value=a),requestAnimationFrame(()=>{if(e.isTyping||!O||(F==null?void 0:F.activeElement)!==O)return;let{selectionStart:L,selectionEnd:J}=O;Math.abs((J!=null?J:0)-(L!=null?L:0))===0&&L===0&&O.setSelectionRange(O.value.length,O.value.length)}))},[I,e.comboboxState,F,e.isTyping]),Me(([a],[N])=>{if(a===0&&N===1){if(e.isTyping)return;let E=R.current;if(!E)return;let k=E.value,{selectionStart:O,selectionEnd:L,selectionDirection:J}=E;E.value="",E.value=k,J!==null?E.setSelectionRange(O,L,J):E.setSelectionRange(O,L)}},[e.comboboxState]);let C=te(!1),A=c(()=>{C.current=!0}),g=c(()=>{w.nextFrame(()=>{C.current=!1})}),h=c(a=>{switch(o.setIsTyping(!0),a.key){case V.Enter:if(e.comboboxState!==0||C.current)return;if(a.preventDefault(),a.stopPropagation(),e.activeOptionIndex===null){o.closeCombobox();return}o.selectActiveOption(),e.mode===0&&o.closeCombobox();break;case V.ArrowDown:return a.preventDefault(),a.stopPropagation(),ne(e.comboboxState,{[0]:()=>o.goToOption(P.Next),[1]:()=>o.openCombobox()});case V.ArrowUp:return a.preventDefault(),a.stopPropagation(),ne(e.comboboxState,{[0]:()=>o.goToOption(P.Previous),[1]:()=>{oe(()=>o.openCombobox()),e.value||o.goToOption(P.Last)}});case V.Home:if(a.shiftKey)break;return a.preventDefault(),a.stopPropagation(),o.goToOption(P.First);case V.PageUp:return a.preventDefault(),a.stopPropagation(),o.goToOption(P.First);case V.End:if(a.shiftKey)break;return a.preventDefault(),a.stopPropagation(),o.goToOption(P.Last);case V.PageDown:return a.preventDefault(),a.stopPropagation(),o.goToOption(P.Last);case V.Escape:return e.comboboxState!==0?void 0:(a.preventDefault(),e.optionsElement&&!e.optionsPropsRef.current.static&&a.stopPropagation(),e.mode===0&&e.value===null&&_(),o.closeCombobox());case V.Tab:if(e.comboboxState!==0)return;e.mode===0&&e.activationTrigger!==1&&o.selectActiveOption(),o.closeCombobox();break}}),B=c(a=>{d==null||d(a),e.mode===0&&a.target.value===""&&_(),o.openCombobox()}),T=c(a=>{var E,k,O;let N=(E=a.relatedTarget)!=null?E:Fe.find(L=>L!==a.currentTarget);if(!((k=e.optionsElement)!=null&&k.contains(N))&&!((O=e.buttonElement)!=null&&O.contains(N))&&e.comboboxState===0)return a.preventDefault(),e.mode===0&&e.value===null&&_(),o.closeCombobox()}),W=c(a=>{var E,k,O;let N=(E=a.relatedTarget)!=null?E:Fe.find(L=>L!==a.currentTarget);(k=e.buttonElement)!=null&&k.contains(N)||(O=e.optionsElement)!=null&&O.contains(N)||e.disabled||e.immediate&&e.comboboxState!==0&&w.microTask(()=>{oe(()=>o.openCombobox()),o.setActivationTrigger(1)})}),Y=ve(),$=gt(),{isFocused:u,focusProps:X}=Ie({autoFocus:r}),{isHovered:z,hoverProps:H}=Pe({isDisabled:i}),v=j(()=>({open:e.comboboxState===0,disabled:i,hover:z,focus:u,autofocus:r}),[e,z,u,r,i]),U=ge({ref:s,id:m,role:"combobox",type:l,"aria-controls":(ee=e.optionsElement)==null?void 0:ee.id,"aria-expanded":e.comboboxState===0,"aria-activedescendant":e.activeOptionIndex===null?void 0:e.virtual?(Q=e.options.find(a=>!a.dataRef.current.disabled&&e.compare(a.dataRef.current.value,e.virtual.options[e.activeOptionIndex])))==null?void 0:Q.id:(K=e.options[e.activeOptionIndex])==null?void 0:K.id,"aria-labelledby":Y,"aria-describedby":$,"aria-autocomplete":"list",defaultValue:(M=(Z=t.defaultValue)!=null?Z:e.defaultValue!==void 0?x==null?void 0:x(e.defaultValue):null)!=null?M:e.defaultValue,disabled:i||void 0,autoFocus:r,onCompositionStart:A,onCompositionEnd:g,onKeyDown:h,onChange:B,onFocus:W,onBlur:T},X,H);return le()({ourProps:U,theirProps:S,slot:v,defaultTag:Mt,name:"Combobox.Input"})}let Ft="button";function Vt(t,n){var B;let e=re("Combobox.Button"),o=ae("Combobox.Button"),f=be(n,o.setButtonElement),b=de(),{id:m=`headlessui-combobox-button-${b}`,disabled:d=e.disabled||!1,autoFocus:x=!1,...i}=t,r=he(e.inputElement),l=c(T=>{switch(T.key){case V.Space:case V.Enter:T.preventDefault(),T.stopPropagation(),e.comboboxState===1&&oe(()=>o.openCombobox()),r();return;case V.ArrowDown:T.preventDefault(),T.stopPropagation(),e.comboboxState===1&&(oe(()=>o.openCombobox()),e.value||o.goToOption(P.First)),r();return;case V.ArrowUp:T.preventDefault(),T.stopPropagation(),e.comboboxState===1&&(oe(()=>o.openCombobox()),e.value||o.goToOption(P.Last)),r();return;case V.Escape:if(e.comboboxState!==0)return;T.preventDefault(),e.optionsElement&&!e.optionsPropsRef.current.static&&T.stopPropagation(),oe(()=>o.closeCombobox()),r();return;default:return}}),S=c(T=>{T.preventDefault(),!ft(T.currentTarget)&&(T.button===Be.Left&&(e.comboboxState===0?o.closeCombobox():o.openCombobox()),r())}),R=ve([m]),{isFocusVisible:s,focusProps:F}=Ie({autoFocus:x}),{isHovered:w,hoverProps:_}=Pe({isDisabled:d}),{pressed:I,pressProps:C}=ze({disabled:d}),A=j(()=>({open:e.comboboxState===0,active:I||e.comboboxState===0,disabled:d,value:e.value,hover:w,focus:s}),[e,w,s,I,d]),g=ge({ref:f,id:m,type:Qe(t,e.buttonElement),tabIndex:-1,"aria-haspopup":"listbox","aria-controls":(B=e.optionsElement)==null?void 0:B.id,"aria-expanded":e.comboboxState===0,"aria-labelledby":R,disabled:d||void 0,autoFocus:x,onMouseDown:S,onKeyDown:l},F,_,C);return le()({ourProps:g,theirProps:i,slot:A,defaultTag:Ft,name:"Combobox.Button"})}let Lt="div",wt=we.RenderStrategy|we.Static;function Bt(t,n){var Q,K,Z;let e=de(),{id:o=`headlessui-combobox-options-${e}`,hold:f=!1,anchor:b,portal:m=!1,modal:d=!0,transition:x=!1,...i}=t,r=re("Combobox.Options"),l=ae("Combobox.Options"),S=pt(b);S&&(m=!0);let[R,s]=lt(S),[F,w]=Re(null),_=at(),I=be(n,S?R:null,l.setOptionsElement,w),C=xe(r.buttonElement||r.inputElement),A=xe(r.optionsElement),g=ct(),[h,B]=ot(x,F,g!==null?(g&me.Open)===me.Open:r.comboboxState===0);qe(h,r.inputElement,l.closeCombobox);let T=r.__demoMode?!1:d&&r.comboboxState===0;Ze(T,A);let W=r.__demoMode?!1:d&&r.comboboxState===0;Xe(W,{allowed:fe(()=>[r.inputElement,r.buttonElement,r.optionsElement],[r.inputElement,r.buttonElement,r.optionsElement])}),q(()=>{var M;r.optionsPropsRef.current.static=(M=t.static)!=null?M:!1},[r.optionsPropsRef,t.static]),q(()=>{r.optionsPropsRef.current.hold=f},[r.optionsPropsRef,f]),nt(r.comboboxState===0,{container:r.optionsElement,accept(M){return M.getAttribute("role")==="option"?NodeFilter.FILTER_REJECT:M.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(M){M.setAttribute("role","none")}});let Y=ve([(Q=r.buttonElement)==null?void 0:Q.id]),$=j(()=>({open:r.comboboxState===0,option:void 0}),[r.comboboxState]),u=c(()=>{l.setActivationTrigger(0)}),X=c(M=>{M.preventDefault(),l.setActivationTrigger(0)}),z=ge(S?_():{},{"aria-labelledby":Y,role:"listbox","aria-multiselectable":r.mode===1?!0:void 0,id:o,ref:I,style:{...i.style,...s,"--input-width":_e(r.inputElement,!0).width,"--button-width":_e(r.buttonElement,!0).width},onWheel:r.activationTrigger===0?void 0:u,onMouseDown:X,...tt(B)}),H=h&&r.comboboxState===1,v=De(H,(K=r.virtual)==null?void 0:K.options),U=De(H,r.value),pe=c(M=>r.compare(U,M));if(r.virtual){if(v===void 0)throw new Error("Missing `options` in virtual mode");Object.assign(i,{children:D.createElement(ue.Provider,{value:v!==r.virtual.options?{...r,virtual:{...r.virtual,options:v}}:r},D.createElement(At,{slot:$},i.children))})}let ee=le();return D.createElement(Ot,{enabled:m?t.static||h:!1,ownerDocument:C},D.createElement(ue.Provider,{value:r.mode===1?r:{...r,isSelected:pe}},ee({ourProps:z,theirProps:{...i,children:D.createElement(dt,{freeze:H},typeof i.children=="function"?(Z=i.children)==null?void 0:Z.call(i,$):i.children)},slot:$,defaultTag:Lt,features:wt,visible:h,name:"Combobox.Options"})))}let Nt="div";function kt(t,n){var u,X,z,H;let e=re("Combobox.Option"),o=ae("Combobox.Option"),f=de(),{id:b=`headlessui-combobox-option-${f}`,value:m,disabled:d=(z=(X=(u=e.virtual)==null?void 0:u.disabled)==null?void 0:X.call(u,m))!=null?z:!1,order:x=null,...i}=t,r=he(e.inputElement),l=e.virtual?e.activeOptionIndex===e.calculateIndex(m):e.activeOptionIndex===null?!1:((H=e.options[e.activeOptionIndex])==null?void 0:H.id)===b,S=e.isSelected(m),R=te(null),s=Je({disabled:d,value:m,domRef:R,order:x}),F=Te(Ne),w=be(n,R,F?F.measureElement:null),_=c(()=>{o.setIsTyping(!1),o.onChange(m)});q(()=>o.registerOption(b,s),[s,b]);let I=te(!(e.virtual||e.__demoMode));q(()=>{if(!e.virtual&&!e.__demoMode)return Le().requestAnimationFrame(()=>{I.current=!0})},[e.virtual,e.__demoMode]),q(()=>{if(I.current&&e.comboboxState===0&&l&&e.activationTrigger!==0)return Le().requestAnimationFrame(()=>{var v,U;(U=(v=R.current)==null?void 0:v.scrollIntoView)==null||U.call(v,{block:"nearest"})})},[R,l,e.comboboxState,e.activationTrigger,e.activeOptionIndex]);let C=c(v=>{v.preventDefault(),v.button===Be.Left&&(d||(_(),xt()||requestAnimationFrame(()=>r()),e.mode===0&&o.closeCombobox()))}),A=c(()=>{if(d)return o.goToOption(P.Nothing);let v=e.calculateIndex(m);o.goToOption(P.Specific,v)}),g=et(),h=c(v=>g.update(v)),B=c(v=>{if(!g.wasMoved(v)||d||l)return;let U=e.calculateIndex(m);o.goToOption(P.Specific,U,0)}),T=c(v=>{g.wasMoved(v)&&(d||l&&(e.optionsPropsRef.current.hold||o.goToOption(P.Nothing)))}),W=j(()=>({active:l,focus:l,selected:S,disabled:d}),[l,S,d]),Y={id:b,ref:w,role:"option",tabIndex:d===!0?void 0:-1,"aria-disabled":d===!0?!0:void 0,"aria-selected":S,disabled:void 0,onMouseDown:C,onFocus:A,onPointerEnter:h,onMouseEnter:h,onPointerMove:B,onMouseMove:B,onPointerLeave:T,onMouseLeave:T};return le()({ourProps:Y,theirProps:i,slot:W,defaultTag:Nt,name:"Combobox.Option"})}let Ht=ie(ht),Ut=ie(Vt),Gt=ie(Dt),zt=vt,Kt=ie(Bt),jt=ie(kt),Ho=Object.assign(Ht,{Input:Gt,Button:Ut,Label:zt,Options:Kt,Option:jt});export{Ho as Combobox,Ut as ComboboxButton,Gt as ComboboxInput,zt as ComboboxLabel,jt as ComboboxOption,Kt as ComboboxOptions};
